/**\n * API Integration Tests\n * Tests for API endpoints\n */\n\nimport { describe, it, expect, beforeAll, afterAll } from '@jest/globals';\n\nconst API_URL = 'http://localhost:3000/api';\nlet authToken: string;\nlet userId: string;\n\ndescribe('API Integration Tests', () => {\n  describe('Authentication', () => {\n    it('should register a new user', async () => {\n      const res = await fetch(`${API_URL}/auth/register`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          email: `test-${Date.now()}@example.com`,\n          username: `testuser${Date.now()}`,\n          password: 'TestPassword123!',\n        }),\n      });\n\n      expect(res.status).toBe(201);\n      const data = await res.json();\n      expect(data).toHaveProperty('tokens');\n      expect(data).toHaveProperty('user');\n    });\n\n    it('should login user', async () => {\n      const res = await fetch(`${API_URL}/auth/login`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'TestPassword123!',\n        }),\n      });\n\n      if (res.status === 200) {\n        const data = await res.json();\n        authToken = data.tokens.accessToken;\n        userId = data.user.id;\n        expect(authToken).toBeDefined();\n      }\n    });\n  });\n\n  describe('Gamification', () => {\n    it('should get user level', async () => {\n      const res = await fetch(`${API_URL}/gamification/level`, {\n        headers: { Authorization: `Bearer ${authToken}` },\n      });\n\n      expect(res.status).toBe(200);\n      const data = await res.json();\n      expect(data).toHaveProperty('level');\n      expect(data).toHaveProperty('xp');\n    });\n\n    it('should get achievements', async () => {\n      const res = await fetch(`${API_URL}/gamification/achievements`, {\n        headers: { Authorization: `Bearer ${authToken}` },\n      });\n\n      expect(res.status).toBe(200);\n      const data = await res.json();\n      expect(Array.isArray(data)).toBe(true);\n    });\n\n    it('should get leaderboard', async () => {\n      const res = await fetch(`${API_URL}/gamification/leaderboard?limit=10&timeframe=month`);\n\n      expect(res.status).toBe(200);\n      const data = await res.json();\n      expect(Array.isArray(data)).toBe(true);\n    });\n  });\n\n  describe('Analytics', () => {\n    it('should get skill profile', async () => {\n      const res = await fetch(\n        `${API_URL}/analytics/skill-profile?playerAccountId=test`,\n        {\n          headers: { Authorization: `Bearer ${authToken}` },\n        }\n      );\n\n      expect([200, 404]).toContain(res.status);\n    });\n\n    it('should get recommendations', async () => {\n      const res = await fetch(\n        `${API_URL}/analytics/recommendations?playerAccountId=test`,\n        {\n          headers: { Authorization: `Bearer ${authToken}` },\n        }\n      );\n\n      expect([200, 404]).toContain(res.status);\n    });\n  });\n\n  describe('Social', () => {\n    it('should get friends list', async () => {\n      const res = await fetch(`${API_URL}/social/friends`, {\n        headers: { Authorization: `Bearer ${authToken}` },\n      });\n\n      expect(res.status).toBe(200);\n      const data = await res.json();\n      expect(Array.isArray(data)).toBe(true);\n    });\n\n    it('should get coaching circles', async () => {\n      const res = await fetch(`${API_URL}/social/circles`, {\n        headers: { Authorization: `Bearer ${authToken}` },\n      });\n\n      expect(res.status).toBe(200);\n      const data = await res.json();\n      expect(Array.isArray(data)).toBe(true);\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should return 401 for unauthorized requests', async () => {\n      const res = await fetch(`${API_URL}/gamification/level`);\n      expect(res.status).toBe(401);\n    });\n\n    it('should return 404 for non-existent endpoints', async () => {\n      const res = await fetch(`${API_URL}/non-existent-endpoint`);\n      expect(res.status).toBe(404);\n    });\n\n    it('should handle rate limiting', async () => {\n      // Make multiple requests quickly\n      const requests = Array(35)\n        .fill(null)\n        .map(() =>\n          fetch(`${API_URL}/gamification/leaderboard`)\n        );\n\n      const responses = await Promise.all(requests);\n      const rateLimited = responses.some((res) => res.status === 429);\n\n      expect(rateLimited).toBe(true);\n    });\n  });\n});\n
