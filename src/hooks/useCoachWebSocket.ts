/**\n * WebSocket Hook for Real-time Coach Communication\n */\n\nimport { useEffect, useRef, useCallback, useState } from 'react';\nimport { useCoach } from '@/contexts/CoachContext';\n\ninterface CoachMessage {\n  type: 'coach_message' | 'match_update' | 'achievement_unlocked' | 'flow_state';\n  data: any;\n  timestamp: string;\n}\n\nexport function useCoachWebSocket() {\n  const wsRef = useRef<WebSocket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const [messages, setMessages] = useState<CoachMessage[]>([]);\n  const { coach } = useCoach();\n\n  // Connect to WebSocket\n  useEffect(() => {\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const wsUrl = `${protocol}//${window.location.host}/ws`;\n\n    const ws = new WebSocket(wsUrl);\n\n    ws.onopen = () => {\n      console.log('WebSocket connected');\n      setIsConnected(true);\n    };\n\n    ws.onmessage = (event) => {\n      try {\n        const message: CoachMessage = JSON.parse(event.data);\n        setMessages((prev) => [...prev, message]);\n      } catch (error) {\n        console.error('Failed to parse WebSocket message:', error);\n      }\n    };\n\n    ws.onerror = (error) => {\n      console.error('WebSocket error:', error);\n      setIsConnected(false);\n    };\n\n    ws.onclose = () => {\n      console.log('WebSocket disconnected');\n      setIsConnected(false);\n    };\n\n    wsRef.current = ws;\n\n    return () => {\n      if (ws.readyState === WebSocket.OPEN) {\n        ws.close();\n      }\n    };\n  }, []);\n\n  // Send coach message\n  const sendCoachMessage = useCallback(\n    (message: string, context?: any) => {\n      if (wsRef.current?.readyState === WebSocket.OPEN) {\n        wsRef.current.send(\n          JSON.stringify({\n            type: 'coach_message',\n            data: {\n              message,\n              personality: coach?.personality,\n              context,\n            },\n          })\n        );\n      }\n    },\n    [coach]\n  );\n\n  // Send match update\n  const sendMatchUpdate = useCallback((matchData: any) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(\n        JSON.stringify({\n          type: 'match_update',\n          data: matchData,\n        })\n      );\n    }\n  }, []);\n\n  // Send achievement unlocked\n  const sendAchievementUnlocked = useCallback((achievement: any) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(\n        JSON.stringify({\n          type: 'achievement_unlocked',\n          data: achievement,\n        })\n      );\n    }\n  }, []);\n\n  return {\n    isConnected,\n    messages,\n    sendCoachMessage,\n    sendMatchUpdate,\n    sendAchievementUnlocked,\n  };\n}\n
